<article>
{{#claims}}
<h1>Hei {{.sub}} üëã</h1>
{{/claims}}
{{^claims}}
<h1>Ikke innlogget</h1>
{{/claims}}

{{#is_uploader?}}
<form>
<input class="uploader-form--file-input" id="image" name="image" required type="file" accept="image/jpeg">
<div class="uploader-form--phase-1">
<label class="uploader-form--link" for="image">Last opp et bilde</label>
</div>
<div class="uploader-form--phase-2">
<img class="uploader-form--preview" src="" alt="preview">
<div class="uploader-form--controls">
    <p>Vil du laste opp dette bildet?</p>
    <p>
        <label class="uploader-form--button uploader-form--button__negative" for="image">‚ùå Nei, et annet</label>
        <button class="uploader-form--button uploader-form--button__default" type="submit">‚úî Ja, dette</button>
    </p>
    <p>
        <button class="uploader-form--link" type="reset">Nei, glem hele opplastingen</button>
    </p>
</div>
</div>
</form>

<script>
// The uploader will work with JS only. Too much mucking about to parse
// multipart messages.

var form = document.querySelector('form');
var fileInput = document.querySelector('input[type="file"]');
var preview = document.querySelector('img');

var phase = 1;

// fetch('img/', {
//     method: 'POST',
//     body: input.files[0]
// });

function state(s) {
    var targetPhase = 1;
    if (s.file) {
        targetPhase = 2;
    }

    if (phase != targetPhase) {
        phase = targetPhase;

        document.querySelector('.uploader-form--phase-1').style.display = (phase == 1 ? 'block' : 'none');
        document.querySelector('.uploader-form--phase-2').style.display = (phase == 2 ? 'block' : 'none');
    }

    if (s.file) {
        preview.src = window.URL.createObjectURL(s.file);
    }
}

fileInput.addEventListener('change', function (ev) {
    ev.preventDefault();
    ev.stopPropagation();
    state({
        file: fileInput.files[0],
    });
});

form.addEventListener('reset', function (ev) {
    state({});
});

state({
    file: fileInput.files[0]
});

</script>
{{/is_uploader}}

{{#authorized_pixurs?}}
<p>Her er bildene vi har delt med deg</p>
<ul class="thumbnails">
{{#authorized_pixurs}}
    <li class="thumbnails--item"><a class="thumbnails--link" href="{{.0}}"><img class="thumbnails--thumbnail" src="thumb/{{.1}}" alt="Pixur {{.0}}"></a></li>
{{/authorized_pixurs}}
</ul>
</article>
{{/authorized_pixurs}}
